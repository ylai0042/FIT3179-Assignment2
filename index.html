<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FIT3179 ‚Äî Assignment 2: Australian Mental Health Data Visualisation</title>

<!-- Vega stack -->
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

<style>
  :root {
    --ink:#111;
    --muted:#586174;
    --bg:#fcfcfd;
    --panel:#fff;
    --border:#e6e6e6;
    --primary:#2563eb;
    --shadow:0 6px 14px rgba(17,24,39,0.08);
  }
  body {
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    margin: 24px;
    background: linear-gradient(180deg, #fff7ed 0%, #ffffff 70%);
    color: var(--ink);
  }
  .wrap {max-width:1100px;margin:auto}
  h1 {line-height:1.2;margin:0 0 8px;text-align:center;letter-spacing:.2px}
  .meta {margin:8px 0 22px;color:var(--muted);text-align:center}
  .card {
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:18px 18px 16px;
    margin-bottom:24px;
    box-shadow: var(--shadow);
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .card h2 {margin:0 0 4px}
  .subtitle {color:var(--ink);font-size:1rem;margin-bottom:8px;text-align:center;font-weight:600}
  .chart-desc {color:var(--ink);font-size:0.98rem;margin:6px 0 12px;text-align:center;font-weight:500}
  figure {margin:0}
  figcaption {margin-top:8px;font-size:.9rem;color:var(--muted)}
  
  /* Storytelling sections styling */
  .story-section {
    background: #fff6ed;
    border-radius: 14px;
    padding: 28px 30px;
    margin: 28px 0 26px;
    border: 1px solid #ffe7d2;
    box-shadow: var(--shadow);
  }
  
  .story-section h2 {
    color: #1f2a44;
    margin-bottom: 14px;
    font-size: 1.5rem;
  }
  
  .story-section p {
    line-height: 1.6;
    margin-bottom: 15px;
    color: #495057;
  }
  
  .story-section ul {
    margin: 15px 0;
    padding-left: 20px;
  }
  
  .story-section li {
    margin-bottom: 8px;
    line-height: 1.5;
  }
  
  .insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 25px 0;
  }
  
  .insight-item {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .insight-item h3 {
    color: var(--primary);
    margin-bottom: 10px;
    font-size: 1.1rem;
  }
  
  .insight-item p {
    margin: 0;
    font-size: 0.95rem;
  }
  
  .chart-callout {
    margin-top: 10px;
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 0.95rem;
    color: #495057;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.06);
  }
  .lifetime-wrap {position: relative}
  .chart-callout--right {position:absolute; right:12px; top:160px; width:360px; max-width:42%}
  @media (max-width: 900px){
    .chart-callout--right {position: static; width:auto; margin-top:10px}
  }
  
  .conclusion-note {
    background: #fff4e5;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #f59e0b;
    margin-top: 25px;
    font-style: italic;
  }
  
  .meta a {color: var(--primary); text-decoration: none}
  .meta a:hover {text-decoration: underline}
</style>
</head>

<body>
<div class="wrap">
  <h1>Australian Mental Health Data Visualisation ‚Äî Assignment 2</h1>
  
  <!-- INTRODUCTION STORYTELLING SECTION -->
  <div class="story-section">
    <h2>Understanding Mental Health in Australia</h2>
    <p>Mental health is a critical public health issue that affects millions of Australians each year. The data presented here offers a comprehensive view of mental and behavioural conditions across different states, demographics, and disorder types in Australia for 2022.</p>
    
    <p>Through interactive visualizations, we'll explore:</p>
    <ul>
      <li><strong>Geographic patterns</strong> - How mental health rates vary across Australian states</li>
      <li><strong>Gender differences</strong> - The varying prevalence of mental disorders between males and females</li>
      <li><strong>Disorder types</strong> - From anxiety and affective disorders to substance use and lifetime prevalence</li>
      <li><strong>Population insights</strong> - Understanding the scale and impact of mental health conditions</li>
    </ul>
    
    <p>This analysis draws from comprehensive health surveys and provides insights into the mental health landscape that can inform policy, healthcare planning, and community awareness initiatives.</p>
  </div>

  <figure class="card">
    <h2>Mental &amp; Behavioural Conditions by State (Australia) 2022</h2>
    <p class="subtitle">Choropleth map showing mental health rates per 1,000 people across Australian states with red color scheme.</p>
    <p class="chart-desc">Rates per 1,000 residents by state/territory; darker red indicates higher prevalence.</p>
    <div id="map"></div>
    <figcaption>
      Projection: Albers; includes graticule and reference outlines. Color intensity represents mental health rates per 1,000 residents using red color scheme.  
      Note: Darker red colors indicate higher prevalence rates; lighter red colors indicate lower rates.
      Source: ABS National Health Survey 2022 (Table 2.1 counts) + ABS ERP 2022 (population). Geometry: Natural Earth Admin-1 for Australia.
    </figcaption>
  </figure>

  <figure class="card">
    <h2>Anxiety Disorders by Sex (2020‚Äì2022)</h2>
    <p class="subtitle">Grouped bar chart comparing anxiety-disorder prevalence by sex. Includes legend selection, dropdown filter, and annotations for highest and lowest prevalence.</p>
    <p class="chart-desc">Compare anxiety disorder categories by sex; use legend and dropdown to focus.</p>
    <div id="bars"></div>
    <figcaption>
      Interactions: click legend to filter by sex; use dropdown to focus on a specific disorder. Annotations highlight the highest and lowest prevalence disorders.
      Note: People values shown are exact counts.
    </figcaption>
  </figure>

  <figure class="card">
    <h2>Affective Disorders by Sex (2020‚Äì2022)</h2>
    <p class="subtitle">Horizontal bar chart comparing affective disorder prevalence by sex with gradient color scheme.</p>
    <p class="chart-desc">Horizontal bars compare depressive episode, dysthymia, bipolar, and overall by sex.</p>
    <div id="affective"></div>
    <figcaption>
      Horizontal layout provides better readability for disorder names. Gradient colors differentiate between disorders.
      Note: People values shown are exact counts.
    </figcaption>
  </figure>

  <figure class="card">
    <h2>Substance Use Disorders by Sex (2020‚Äì2022)</h2>
    <p class="subtitle">Area chart showing substance use disorder prevalence by sex with smooth curves and transparency.</p>
    <p class="chart-desc">Overlapping areas show magnitude and male/female differences across substance categories.</p>
    <div id="substance"></div>
    <figcaption>
      Area chart format emphasizes the magnitude differences between disorders. Semi-transparent overlays show gender differences.
      Note: People values shown are exact counts.
    </figcaption>
  </figure>

  <figure class="card">
    <h2>Lifetime Mental Disorders Summary by Sex (2020‚Äì2022)</h2>
    <p class="subtitle">Donut chart displaying the proportion of people with and without lifetime mental disorders, comparing male and female populations.</p>
    <p class="chart-desc">Composition of ‚ÄúAny lifetime mental disorder‚Äù vs ‚ÄúNo lifetime mental disorder‚Äù by sex.</p>
    <div class="lifetime-wrap">
      <div id="lifetime"></div>
      <div class="chart-callout chart-callout--right">
        <div><strong>Males</strong> are higher in <strong>‚ÄúNo lifetime mental disorder‚Äù</strong> (~5.6M).</div>
        <div><strong>Females</strong> are higher in <strong>‚ÄúAny lifetime mental disorder‚Äù</strong> (~4.4M).</div>
      </div>
    </div>
    <figcaption>
      Donut chart shows the distribution of mental health status across genders. Use the dropdown to filter by specific disorder types.
      Note: People values shown are exact counts.
    </figcaption>
  </figure>

  <!-- CONCLUSION STORYTELLING SECTION -->
  <div class="story-section">
    <h2>Key Insights and Implications</h2>
    <p>The visualizations reveal important patterns in Australia's mental health landscape:</p>
    
    <div class="insights-grid">
      <div class="insight-item">
        <h3>üó∫Ô∏è Geographic Variations</h3>
        <p>Mental health rates vary significantly across states, highlighting the importance of region-specific healthcare strategies and resource allocation.</p>
      </div>
      
      <div class="insight-item">
        <h3>üë• Gender Disparities</h3>
        <p>Clear differences emerge between male and female populations across different disorder types, suggesting the need for gender-sensitive mental health interventions.</p>
      </div>
      
      <div class="insight-item">
        <h3>üìä Disorder Prevalence</h3>
        <p>Anxiety disorders show the highest prevalence, while obsessive-compulsive disorders have the lowest rates, indicating varying levels of public awareness and diagnosis.</p>
      </div>
      
      <div class="insight-item">
        <h3>üéØ Policy Implications</h3>
        <p>These findings underscore the need for comprehensive mental health policies that address geographic, demographic, and disorder-specific challenges across Australia.</p>
      </div>
    </div>
    
    <p class="conclusion-note">
      <strong>Moving Forward:</strong> This data provides a foundation for evidence-based decision making in mental health policy, healthcare planning, and community support programs. Understanding these patterns is crucial for developing targeted interventions that can improve mental health outcomes for all Australians.
    </p>
  </div>

    <p class="meta">
      Author: Yishu Lai ¬∑ Data sources: ABS National Health Survey 2022 (Table 2.1) and ABS National Study of Mental Health and Wellbeing 2020‚Äì22.
    </p>
    <p class="meta">
      Sources:
      <a href="https://www.abs.gov.au/statistics/health/mental-health/national-study-mental-health-and-wellbeing/latest-release" target="_blank" rel="noopener">ABS National Study of Mental Health and Wellbeing ‚Äî latest release</a>
      ¬∑
      <a href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey/latest-release?utm_source=chatgpt.com#data-downloads" target="_blank" rel="noopener">ABS National Health Survey ‚Äî latest release (Data downloads)</a>
    </p>
</div>

<script>
// -------------------- ASSIGNMENT 2 MAP --------------------
const mapSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width":800,"height":550,"padding":20,
  "projection":{"type":"albers","rotate":[-134,0,0],"center":[0,-28],"parallels":[-18,-36],"scale":900},
  "layer":[
    {"data":{"sphere":{}},"mark":{"type":"geoshape","fill":"#F8F9FA"}},
    {"data":{"graticule":{"step":[20,20]}},"mark":{"type":"geoshape","stroke":"#E9ECEF","strokeWidth":0.8,"filled":false}},
    {
      "data":{"url":"au_admin_1_states_provinces.json","format":{"type":"topojson","feature":"ne_10m_admin_1_states_provinces"}},
      "transform":[
        {"filter":{"field":"properties.name","oneOf":["New South Wales","Victoria","Queensland","South Australia","Western Australia","Tasmania","Northern Territory","Australian Capital Territory"]}},
        {"lookup":"properties.name",
         "from":{"data":{"url":"combined_health.csv","format":{"type":"csv","parse":{"persons":"number","population":"number","rate_per_1000":"number"}}},
                 "key":"group","fields":["persons","population","rate_per_1000"]}},
        {"calculate":"isValid(datum.rate_per_1000) ? datum.rate_per_1000 : (datum.persons/datum.population)*1000","as":"Rate_per_1000"}
      ],
      "mark":{"type":"geoshape","stroke":"#fff","strokeWidth":2},
      "encoding":{
        "color":{"field":"Rate_per_1000","type":"quantitative","title":"Mental Health Rate per 1,000","scale":{"scheme":"reds","range":["#FFF5F5","#7F1D1D"]}},
        "tooltip":[
          {"field":"properties.name","title":"State / Territory"},
          {"field":"persons","type":"quantitative","title":"Total Cases","format":",.0f"},
          {"field":"population","type":"quantitative","title":"Population (ERP 2022)","format":",.0f"},
          {"field":"Rate_per_1000","type":"quantitative","title":"Rate per 1,000","format":",.1f"}
        ]
      }
    }
  ],
  "config":{"view":{"stroke":null},"legend":{"titleFontSize":12,"labelFontSize":12,"titleColor":"#343A40","labelColor":"#6C757D"},"axis":{"labelFontSize":11,"titleFontSize":12}}
};
// -------------------- ASSIGNMENT 2 CHART --------------------
const barsSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 900,
  "height": 480,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "params": [
    {
      "name": "disSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Panic Disorder",
          "Agoraphobia",
          "Social Phobia",
          "Generalised Anxiety Disorder",
          "Obsessive-Compulsive Disorder",
          "Post-Traumatic Stress Disorder",
          "Any Anxiety disorder"
        ]
      }
    }
  ],
  "transform": [
    { "filter": "datum.dataset==='anxiety_by_sex'" },
    { "calculate": "toNumber(datum.value)", "as": "value" },
    { "filter": "isValid(datum.value)" }
  ],
  "layer": [
    // --- base grouped bars instead of stacked
    {
      "mark": { "type": "bar", "cornerRadius": 4, "stroke": "#fff", "strokeWidth": 1 },
      "params": [
        { "name": "sexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" }
      ],
      "encoding": {
        "x": {
          "field": "group",
          "type": "nominal",
          "title": "Anxiety Disorder Type",
          "axis": {
            "labelAngle": -35,
            "labelFontSize": 12,
            "titleFontSize": 14,
            "labelLimit": 200,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": {
          "condition": [
            { "test": "disSelect==='All' || datum.group===disSelect", "value": 1 },
            { "param": "sexSelect", "value": 0.8 }
          ],
          "value": 0.2
        },
        "tooltip": [
          { "field": "group", "title": "Anxiety Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    // --- annotation for highest prevalence appears only when All is selected
    {
      "transform": [
        { "filter": "disSelect==='All'" },
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] },
        { "filter": "datum.rk===1" },
        { "calculate": "datum.group + ' (highest)'", "as": "note" }
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dy": -25 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" },
        "y": { "field": "total", "type": "quantitative" },
        "text": { "field": "note" }
      }
    },
    // --- annotation for lowest prevalence appears only when All is selected
    {
      "transform": [
        { "filter": "disSelect==='All'" },
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] },
        { "filter": "datum.rk===7" }
      ],
      "layer": [
        {
          "mark": { 
            "type": "text", 
            "align": "center", 
            "fontSize": 12, 
            "fontWeight": "bold", 
            "color": "#495057", 
            "dy": -35 
          },
          "encoding": {
            "x": { "field": "group", "type": "nominal" },
            "y": { "field": "total", "type": "quantitative" },
            "text": { "value": "Obsessive-Compulsive" }
          }
        },
        {
          "mark": { 
            "type": "text", 
            "align": "center", 
            "fontSize": 12, 
            "fontWeight": "bold", 
            "color": "#495057", 
            "dy": -20 
          },
          "encoding": {
            "x": { "field": "group", "type": "nominal" },
            "y": { "field": "total", "type": "quantitative" },
            "text": { "value": "(lowest)" }
          }
        }
      ]
    },
    // --- annotation that follows dropdown selection (single anxiety disorder chosen)
    {
      "transform": [
        { "filter": "disSelect!=='All'" },
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "filter": "datum.group===disSelect" },
        { "calculate": "datum.group + ' (selected)'", "as": "note" }
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#111", 
        "dy": -18 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" },
        "y": { "field": "total", "type": "quantitative" },
        "text": { "field": "note" }
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};


// -------------------- ASSIGNMENT 2 AFFECTIVE CHART --------------------
const affectiveSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 360,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "params": [
    {
      "name": "affectiveSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Depressive Episode",
          "Dysthymia",
          "Bipolar Affective Disorder",
          "Any Affective disorder"
        ]
      }
    }
  ],
  "transform": [
    { "filter": "datum.dataset==='affective_by_sex'" },
    { "calculate": "toNumber(datum.value)", "as": "value" },
    { "filter": "isValid(datum.value)" }
  ],
  "layer": [
    {
      "mark": { 
        "type": "bar", 
        "cornerRadius": 3, 
        "stroke": "#fff", 
        "strokeWidth": 1 
      },
      "params": [
        { "name": "affectiveSexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" }
      ],
      "encoding": {
        "x": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "group", 
          "type": "nominal", 
          "title": "Affective Disorder Type",
          "axis": {
            "labelFontSize": 12,
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": {
          "condition": [
            { "test": "affectiveSelect==='All' || datum.group===affectiveSelect", "value": 1 },
            { "param": "affectiveSexSelect", "value": 0.8 }
          ],
          "value": 0.2
        },
        "tooltip": [
          { "field": "group", "title": "Affective Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [
        { "filter": "affectiveSelect==='All'" },
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] },
        { "filter": "datum.rk===1" }
      ],
      "mark": { 
        "type": "text", 
        "align": "left", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dx": 10 
      },
      "encoding": {
        "x": { "field": "total", "type": "quantitative" },
        "y": { "field": "group", "type": "nominal" },
        "text": { "value": "‚Üê Highest" }
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};

// -------------------- ASSIGNMENT 2 SUBSTANCE CHART --------------------
const substanceSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 850,
  "height": 360,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "transform": [
    { "filter": "datum.dataset==='substance_by_sex'" },
    { "calculate": "toNumber(datum.value)", "as": "value" },
    { "filter": "isValid(datum.value)" }
  ],
  "layer": [
    {
      "mark": { 
        "type": "area", 
        "interpolate": "cardinal",
        "opacity": 0.7
      },
      "params": [
        { "name": "substanceSexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" }
      ],
      "encoding": {
        "x": { 
          "field": "group", 
          "type": "nominal", 
          "title": "Substance Use Disorder Type",
          "axis": {
            "labelAngle": -45,
            "labelFontSize": 11,
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": { "condition": { "param": "substanceSexSelect", "value": 0.7 }, "value": 0.25 },
        "tooltip": [
          { "field": "group", "title": "Substance Use Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] },
        { "filter": "datum.rk===1" }
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dy": -10 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" },
        "y": { "field": "total", "type": "quantitative" },
        "text": { "value": "‚Üë Highest" }
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};

// -------------------- ASSIGNMENT 2 LIFETIME CHART --------------------
const lifetimeSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 560,
  "height": 300,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "params": [
    {
      "name": "lifetimeSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Any lifetime mental disorder",
          "No lifetime mental disorder"
        ]
      }
    }
  ],
  "transform": [
    { "filter": "datum.dataset==='lifetime_by_sex'" },
    { "calculate": "toNumber(datum.value)", "as": "value" },
    { "filter": "isValid(datum.value)" },
    { "filter": "datum.group !== 'Total'" },
    { "filter": "lifetimeSelect==='All'|| datum.group===lifetimeSelect" }
  ],
  "mark": { 
    "type": "arc", 
    "innerRadius": 60,
    "stroke": "#fff",
    "strokeWidth": 2
  },
  "encoding": {
    "theta": { 
      "field": "value", 
      "type": "quantitative" 
    },
    "color": { 
      "field": "sex", 
      "type": "nominal", 
      "title": "Gender",
      "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
    },
    "tooltip": [
      { "field": "group", "title": "Mental Health Status" },
      { "field": "sex", "title": "Gender" },
      { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
    ]
  },
  "config": {
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" }
  }
};

// -------------------- EMBED ALL CHARTS --------------------
vegaEmbed("#map", mapSpec, {actions:false});
vegaEmbed("#bars", barsSpec, {actions:false});
vegaEmbed("#affective", affectiveSpec, {actions:false});
vegaEmbed("#substance", substanceSpec, {actions:false});
vegaEmbed("#lifetime", lifetimeSpec, {actions:false});
</script>
</body>
</html>
