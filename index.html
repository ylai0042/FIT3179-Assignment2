<!doctype html> <!-- HTML5 doctype ensures standards mode rendering -->
<html lang="en"> <!-- Set document language to English for accessibility/SEO -->
<head> <!-- Document metadata and resource loading -->
<meta charset="utf-8"/> <!-- UTF-8 encoding supports all characters -->
<meta name="viewport" content="width=device-width, initial-scale=1"/> <!-- Responsive scaling on mobile -->
<title>FIT3179 — Assignment 2: Australian Mental Health Data Visualisation</title> <!-- Page title shown in browser tab -->

<!-- Vega stack --> <!-- Load Vega runtime, Vega-Lite grammar, and vega-embed helper from CDN -->
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script> <!-- Core Vega runtime -->
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script> <!-- High-level declarative chart grammar -->
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script> <!-- Helper to mount specs into DOM -->

<style> /* Inline CSS styles for layout, typography, and components */
  :root { /* Design tokens (colors, shadow) */
    --ink:#111;
    --muted:#586174;
    --bg:#fcfcfd;
    --panel:#fff;
    --border:#e6e6e6;
    --primary:#2563eb;
    --shadow:0 6px 14px rgba(17,24,39,0.08);
  }
  body { /* Base page styling */
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    margin: 24px;
    background: linear-gradient(180deg, #fff7ed 0%, #ffffff 70%);
    color: var(--ink);
  }
  .wrap {max-width:1100px;margin:auto} /* Centered content column */
  h1 {line-height:1.2;margin:0 0 8px;text-align:center;letter-spacing:.2px} /* Main title */
  .meta {margin:8px 0 22px;color:var(--muted);text-align:center} /* Small helper text */
  .card { /* Reusable card container around charts */
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:14px;
    padding:18px 18px 16px;
    margin-bottom:24px;
    box-shadow: var(--shadow);
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .card h2 {margin:0 0 4px} /* Card title spacing */
  .subtitle {color:var(--ink);font-size:1rem;margin-bottom:8px;text-align:center;font-weight:600} /* Subtitle line */
  .chart-desc {color:var(--ink);font-size:0.98rem;margin:6px 0 12px;text-align:center;font-weight:500} /* Chart description */
  figure {margin:0} /* Remove default figure margins */
  figcaption {margin-top:8px;font-size:.9rem;color:var(--muted)} /* Caption under charts */
  
  /* Storytelling sections styling */
  .story-section { /* Intro/Conclusion narrative blocks */
    background: #fff6ed;
    border-radius: 14px;
    padding: 28px 30px;
    margin: 28px 0 26px;
    border: 1px solid #ffe7d2;
    box-shadow: var(--shadow);
  }
  
  .story-section h2 { /* Section headings */
    color: #1f2a44;
    margin-bottom: 14px;
    font-size: 1.5rem;
  }
  
  .story-section p { /* Paragraphs inside storytelling blocks */
    line-height: 1.6;
    margin-bottom: 15px;
    color: #495057;
  }
  
  .story-section ul { /* Bulleted list layout */
    margin: 15px 0;
    padding-left: 20px;
  }
  
  .story-section li { /* Item spacing */
    margin-bottom: 8px;
    line-height: 1.5;
  }
  
  .insights-grid { /* Responsive 2–4 column grid for insights */
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 25px 0;
  }
  
  .insight-item { /* Individual insight card */
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .insight-item h3 { /* Insight title */
    color: var(--primary);
    margin-bottom: 10px;
    font-size: 1.1rem;
  }
  
  .insight-item p { /* Insight body */
    margin: 0;
    font-size: 0.95rem;
  }
  
  .chart-callout { /* Right-hand note beside donut chart */
    margin-top: 10px;
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 0.95rem;
    color: #495057;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.06);
  }
  .lifetime-wrap {position: relative} /* Enables absolute positioning of callout */
  .chart-callout--right {position:absolute; right:12px; top:160px; width:360px; max-width:42%} /* Callout position */
  @media (max-width: 900px){
    .chart-callout--right {position: static; width:auto; margin-top:10px} /* Stack on small screens */
  }
  
  .conclusion-note { /* Emphasized concluding paragraph */
    background: #fff4e5;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #f59e0b;
    margin-top: 25px;
    font-style: italic;
  }
  
  .meta a {color: var(--primary); text-decoration: none} /* Link color in meta areas */
  .meta a:hover {text-decoration: underline} /* Hover underline for usability */
</style> <!-- End CSS -->
</head> <!-- End head -->

<body> <!-- Page content -->
<div class="wrap"> <!-- Constrains content width and centers it -->
  <h1>Australian Mental Health Data Visualisation — Assignment 2</h1> <!-- Main heading -->
  
  <!-- INTRODUCTION STORYTELLING SECTION -->
  <div class="story-section"> <!-- Intro narrative block -->
    <h2>Understanding Mental Health in Australia</h2> <!-- Section title -->
    <p>Mental health is a critical public health issue that affects millions of Australians each year. The data presented here offers a comprehensive view of mental and behavioural conditions across different states, demographics, and disorder types in Australia for 2022.</p> <!-- Context paragraph -->
    
    <p>Through interactive visualizations, we'll explore:</p> <!-- Lead-in to bullet list -->
    <ul> <!-- Key topics list -->
      <li><strong>Geographic patterns</strong> - How mental health rates vary across Australian states</li> <!-- Bullet 1 -->
      <li><strong>Gender differences</strong> - The varying prevalence of mental disorders between males and females</li> <!-- Bullet 2 -->
      <li><strong>Disorder types</strong> - From anxiety and affective disorders to substance use and lifetime prevalence</li> <!-- Bullet 3 -->
      <li><strong>Population insights</strong> - Understanding the scale and impact of mental health conditions</li> <!-- Bullet 4 -->
    </ul> <!-- End list -->
    
    <p>This analysis draws from comprehensive health surveys and provides insights into the mental health landscape that can inform policy, healthcare planning, and community awareness initiatives.</p> <!-- Closing paragraph -->
  </div> <!-- End storytelling section -->

  <figure class="card"> <!-- Card containing the choropleth map -->
    <h2>Mental &amp; Behavioural Conditions by State (Australia) 2022</h2> <!-- Card title -->
    <p class="subtitle">Choropleth map of mental health rates per 1,000 people across Australian states using a soft red palette on a blue ocean background.</p> <!-- Brief subtitle -->
    <p class="chart-desc">Rates per 1,000 residents by state/territory. A white callout box highlights the state with the highest rate.</p> <!-- How to read the chart -->
    <div id="map"></div> <!-- Mount point for the map -->
    <figcaption>
      Projection: Albers; includes graticule and reference outlines. Color intensity represents mental health rates per 1,000 residents using a soft red color scheme.  
      Note: darker reds indicate higher prevalence; lighter reds indicate lower rates. A labelled text box annotates the state with the highest rate for quick reference.
      Source: ABS National Health Survey 2022 (Table 2.1 counts) + ABS ERP 2022 (population). Geometry: Natural Earth Admin-1 for Australia.
    </figcaption> <!-- Data notes and reading guide -->
  </figure> <!-- End map card -->

  <figure class="card"> <!-- Card containing grouped bar chart -->
    <h2>Anxiety Disorders by Sex (2020–2022)</h2> <!-- Chart title -->
    <p class="subtitle">Grouped bar chart comparing anxiety-disorder prevalence by sex. Includes legend selection, dropdown filter, and annotations for highest and lowest prevalence.</p> <!-- Subtitle -->
    <p class="chart-desc">Compare anxiety disorder categories by sex; use legend and dropdown to focus.</p> <!-- Chart guide -->
    <div id="bars"></div> <!-- Mount point for bars -->
    <figcaption>
      Interactions: click legend to filter by sex; use dropdown to focus on a specific disorder. Annotations highlight the highest and lowest prevalence disorders.
      Note: People values shown are exact counts.
    </figcaption> <!-- Interaction notes -->
  </figure> <!-- End bars card -->

  <figure class="card"> <!-- Affective disorders horizontal bars -->
    <h2>Affective Disorders by Sex (2020–2022)</h2> <!-- Title -->
    <p class="subtitle">Horizontal bar chart comparing affective disorder prevalence by sex with gradient color scheme.</p> <!-- Subtitle -->
    <p class="chart-desc">Horizontal bars compare depressive episode, dysthymia, bipolar, and overall by sex.</p> <!-- Description -->
    <div id="affective"></div> <!-- Mount point -->
    <figcaption>
      Horizontal layout provides better readability for disorder names. Gradient colors differentiate between disorders.
      Note: People values shown are exact counts.
    </figcaption> <!-- Caption -->
  </figure> <!-- End affective card -->

  <figure class="card"> <!-- Substance use area chart -->
    <h2>Substance Use Disorders by Sex (2020–2022)</h2> <!-- Title -->
    <p class="subtitle">Area chart showing substance use disorder prevalence by sex with smooth curves and transparency.</p> <!-- Subtitle -->
    <p class="chart-desc">Overlapping areas show magnitude and male/female differences across substance categories.</p> <!-- Description -->
    <div id="substance"></div> <!-- Mount point -->
    <figcaption>
      Area chart format emphasizes the magnitude differences between disorders. Semi-transparent overlays show gender differences.
      Note: People values shown are exact counts.
    </figcaption> <!-- Caption -->
  </figure> <!-- End substance card -->

  <figure class="card"> <!-- Lifetime donut chart with side callout -->
    <h2>Lifetime Mental Disorders Summary by Sex (2020–2022)</h2> <!-- Title -->
    <p class="subtitle">Donut chart displaying the proportion of people with and without lifetime mental disorders, comparing male and female populations.</p> <!-- Subtitle -->
    <p class="chart-desc">Composition of “Any lifetime mental disorder” vs “No lifetime mental disorder” by sex.</p> <!-- Description -->
    <div class="lifetime-wrap"> <!-- Wrapper to position callout beside chart -->
      <div id="lifetime"></div> <!-- Mount point -->
      <div class="chart-callout chart-callout--right"> <!-- Right-side note -->
        <div><strong>Males</strong> are higher in <strong>“No lifetime mental disorder”</strong> (~5.6M).</div> <!-- Callout line 1 -->
        <div><strong>Females</strong> are higher in <strong>“Any lifetime mental disorder”</strong> (~4.4M).</div> <!-- Callout line 2 -->
      </div>
    </div> <!-- End wrapper -->
    <figcaption>
      Donut chart shows the distribution of mental health status across genders. Use the dropdown to filter by specific disorder types.
      Note: People values shown are exact counts.
    </figcaption> <!-- Caption -->
  </figure> <!-- End lifetime card -->

  <!-- CONCLUSION STORYTELLING SECTION -->
  <div class="story-section"> <!-- Conclusion narrative block -->
    <h2>Key Insights and Implications</h2> <!-- Section title -->
    <p>The visualizations reveal important patterns in Australia's mental health landscape:</p> <!-- Lead-in -->
    
    <div class="insights-grid"> <!-- Grid of four takeaway cards -->
      <div class="insight-item"> <!-- Insight 1 -->
        <h3>🗺️ Geographic Variations</h3> <!-- Title -->
        <p>Mental health rates vary significantly across states, highlighting the importance of region-specific healthcare strategies and resource allocation.</p> <!-- Body -->
      </div>
      
      <div class="insight-item"> <!-- Insight 2 -->
        <h3>👥 Gender Disparities</h3> <!-- Title -->
        <p>Clear differences emerge between male and female populations across different disorder types, suggesting the need for gender-sensitive mental health interventions.</p> <!-- Body -->
      </div>
      
      <div class="insight-item"> <!-- Insight 3 -->
        <h3>📊 Disorder Prevalence</h3> <!-- Title -->
        <p>Anxiety disorders show the highest prevalence, while obsessive-compulsive disorders have the lowest rates, indicating varying levels of public awareness and diagnosis.</p> <!-- Body -->
      </div>
      
      <div class="insight-item"> <!-- Insight 4 -->
        <h3>🎯 Policy Implications</h3> <!-- Title -->
        <p>These findings underscore the need for comprehensive mental health policies that address geographic, demographic, and disorder-specific challenges across Australia.</p> <!-- Body -->
      </div>
    </div> <!-- End insights grid -->
    
    <p class="conclusion-note">
      <strong>Moving Forward:</strong> This data provides a foundation for evidence-based decision making in mental health policy, healthcare planning, and community support programs. Understanding these patterns is crucial for developing targeted interventions that can improve mental health outcomes for all Australians.
    </p> <!-- Emphasized conclusion -->
  </div> <!-- End conclusion storytelling -->

    <p class="meta">
      Author: Yishu Lai · Data sources: ABS National Health Survey 2022 (Table 2.1) and ABS National Study of Mental Health and Wellbeing 2020–22.
    </p> <!-- Source attribution line 1 -->
    <p class="meta">
      Sources:
      <a href="https://www.abs.gov.au/statistics/health/mental-health/national-study-mental-health-and-wellbeing/latest-release" target="_blank" rel="noopener">ABS National Study of Mental Health and Wellbeing — latest release</a>
      ·
      <a href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey/latest-release?utm_source=chatgpt.com#data-downloads" target="_blank" rel="noopener">ABS National Health Survey — latest release (Data downloads)</a>
    </p> <!-- Source attribution line 2 with links -->
    <p class="meta">
      <a href="https://github.com/ylai0042/FIT3179-Assignment2/blob/main/FIT3179A2%20Five%20design%20sheet.pdf" target="_blank" rel="noopener">Five design sheet (PDF)</a>
    </p> <!-- Link to five design sheets -->
</div> <!-- End wrap -->

<script> // Begin JavaScript: define Vega-Lite specs and embed them

// -------------------- ASSIGNMENT 2 MAP --------------------
// Choropleth map spec; logic unchanged, comments explain each step
const mapSpec = { // Choropleth map spec
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json", // Use Vega-Lite v5 schema
  "width":800,"height":580,"padding":20, // Canvas size and padding
  "projection":{"type":"albers","rotate":[-134,0,0],"center":[0,-28],"parallels":[-18,-36],"scale":900}, // AU-friendly Albers projection
  "layer":[ // Compose background, graticule, states, and annotation layers
    {"data":{"sphere":{}},"mark":{"type":"geoshape","fill":"#86C8E1"}}, // Ocean background fill
    {"data":{"graticule":{"step":[20,20]}},"mark":{"type":"geoshape","stroke":"#7bb8cf","strokeWidth":0.8,"filled":false}}, // Lat/long grid
    {
      "data":{"url":"au_admin_1_states_provinces.json","format":{"type":"topojson","feature":"ne_10m_admin_1_states_provinces"}}, // AU Admin-1 shapes
      "transform":[ // Keep only AU states/territories and join CSV
        {"filter":{"field":"properties.name","oneOf":["New South Wales","Victoria","Queensland","South Australia","Western Australia","Tasmania","Northern Territory","Australian Capital Territory"]}}, // Filter to AU regions
        {"lookup":"properties.name",
         "from":{"data":{"url":"combined_health.csv","format":{"type":"csv","parse":{"persons":"number","population":"number","rate_per_1000":"number"}}},
                 "key":"group","fields":["persons","population","rate_per_1000"]}}, // Join counts/pop/rate by state name
        {"calculate":"isValid(datum.rate_per_1000) ? datum.rate_per_1000 : (datum.persons/datum.population)*1000","as":"Rate_per_1000"} // Fallback to derived rate if missing
      ],
      "mark":{"type":"geoshape","stroke":"#fff","strokeWidth":2}, // Render filled states with white borders
      "encoding":{
        "color":{"field":"Rate_per_1000","type":"quantitative","title":"Mental Health Rate per 1,000","scale":{"range":["#FFE9E6","#FFB8B2","#FF8A80"]}}, // Soft red scale
        "tooltip":[ // Tooltip fields for hover
          {"field":"properties.name","title":"State / Territory"},
          {"field":"persons","type":"quantitative","title":"Total Cases","format":",.0f"},
          {"field":"population","type":"quantitative","title":"Population (ERP 2022)","format":",.0f"},
          {"field":"Rate_per_1000","type":"quantitative","title":"Rate per 1,000","format":",.1f"}
        ]
      }
    },
    {
      "data": {"values": [ // Hard-coded anchor points near each region for annotation placement
        {"group":"New South Wales","lon":147.0,"lat":-33.5},
        {"group":"Victoria","lon":144.5,"lat":-37.0},
        {"group":"Queensland","lon":145.0,"lat":-20.0},
        {"group":"South Australia","lon":135.0,"lat":-30.0},
        {"group":"Western Australia","lon":122.0,"lat":-25.0},
        {"group":"Tasmania","lon":146.7,"lat":-42.0},
        {"group":"Northern Territory","lon":133.0,"lat":-20.0},
        {"group":"Australian Capital Territory","lon":149.1,"lat":-35.4}
      ]},
      "transform": [ // Find the highest rate and attach a note
        {"lookup":"group",
         "from": {"data":{"url":"combined_health.csv","format":{"type":"csv","parse":{"persons":"number","population":"number","rate_per_1000":"number"}}},
                   "key":"group","fields":["dataset","persons","population","rate_per_1000"]}
        }, // Join attributes for rate calculation
        {"filter":"datum.dataset==='mental_behavioural_by_state'"}, // Limit to the state-level dataset
        {"calculate":"isValid(datum.rate_per_1000) ? datum.rate_per_1000 : (datum.persons/datum.population)*1000","as":"Rate_per_1000"}, // Derive rate if needed
        {"window":[{"op":"rank","as":"rk"}],"sort":[{"field":"Rate_per_1000","order":"descending"}]}, // Rank states by rate
        {"filter":"datum.rk===1"}, // Keep only the top-ranked state
        {"calculate":"datum.group + ' — highest rate'","as":"note"} // Text to display
      ],
      "mark":{"type":"text","align":"left","dx":10,"dy":-10,"fontSize":12,"fontWeight":"bold","color":"#111","background":"#ffffff","cornerRadius":4,"lineHeight":14,"tooltip":null,"padding":4}, // Styled text label
      "encoding":{
        "longitude":{"field":"lon","type":"quantitative"}, // Place label using lon
        "latitude":{"field":"lat","type":"quantitative"}, // and lat
        "text":{"field":"note"} // Label content
      }
    }
  ],
  "config":{"view":{"stroke":null},"legend":{"titleFontSize":12,"labelFontSize":12,"titleColor":"#343A40","labelColor":"#6C757D"},"axis":{"labelFontSize":11,"titleFontSize":12}} // Aesthetic config
};
// -------------------- ASSIGNMENT 2 CHART --------------------
const barsSpec = { // Grouped bars for anxiety by sex
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json", // Vega-Lite schema
  "width": 900, // Chart width
  "height": 450, // Chart height
  "padding": 20, // Padding
  "data": { "url": "combined_health.csv" }, // Source CSV
  "params": [ // UI controls
    {
      "name": "disSelect", // Dropdown param name
      "value": "All", // Default value
      "bind": { // Bind to a <select>
        "input": "select",
        "options": [
          "All",
          "Panic Disorder",
          "Agoraphobia",
          "Social Phobia",
          "Generalised Anxiety Disorder",
          "Obsessive-Compulsive Disorder",
          "Post-Traumatic Stress Disorder",
          "Any Anxiety disorder"
        ]
      }
    }
  ],
  "transform": [ // Data filtering and coercion
    { "filter": "datum.dataset==='anxiety_by_sex'" }, // Keep anxiety subset
    { "calculate": "toNumber(datum.value)", "as": "value" }, // Ensure numeric values
    { "filter": "isValid(datum.value)" } // Drop invalids
  ],
  "layer": [ // Visual layers: bars + annotations
    // --- base grouped bars instead of stacked
    {
      "mark": { "type": "bar", "cornerRadius": 4, "stroke": "#fff", "strokeWidth": 1 }, // Rounded bars with white edges
      "params": [
        { "name": "sexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" } // Click legend to filter sex
      ],
      "encoding": {
        "x": {
          "field": "group",
          "type": "nominal",
          "title": "Anxiety Disorder Type",
          "axis": {
            "labelAngle": -35,
            "labelFontSize": 12,
            "titleFontSize": 14,
            "labelLimit": 200,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": {
          "condition": [
            { "test": "disSelect==='All' || datum.group===disSelect", "value": 1 }, // Dim bars not in dropdown focus
            { "param": "sexSelect", "value": 0.8 } // Slightly dim deselected sex
          ],
          "value": 0.2 // Base dim level
        },
        "tooltip": [
          { "field": "group", "title": "Anxiety Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    // --- annotation for highest prevalence appears only when All is selected
    {
      "transform": [
        { "filter": "disSelect==='All'" }, // Only when viewing All
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] }, // Sum across sex
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] }, // Rank categories
        { "filter": "datum.rk===1" }, // Keep top
        { "calculate": "datum.group + ' (highest)'", "as": "note" } // Label text
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dy": -25 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" }, // Place above the highest bar category
        "y": { "field": "total", "type": "quantitative" }, // At bar height
        "text": { "field": "note" } // Text content
      }
    },
    // --- annotation for lowest prevalence appears only when All is selected
    {
      "transform": [
        { "filter": "disSelect==='All'" }, // Only when viewing All
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] },
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] },
        { "filter": "datum.rk===7" } // 7th out of 7 categories is lowest
      ],
      "layer": [
        {
          "mark": { 
            "type": "text", 
            "align": "center", 
            "fontSize": 12, 
            "fontWeight": "bold", 
            "color": "#495057", 
            "dy": -35 
          },
          "encoding": {
            "x": { "field": "group", "type": "nominal" },
            "y": { "field": "total", "type": "quantitative" },
            "text": { "value": "Obsessive-Compulsive" } // Static label for clarity
          }
        },
        {
          "mark": { 
            "type": "text", 
            "align": "center", 
            "fontSize": 12, 
            "fontWeight": "bold", 
            "color": "#495057", 
            "dy": -20 
          },
          "encoding": {
            "x": { "field": "group", "type": "nominal" },
            "y": { "field": "total", "type": "quantitative" },
            "text": { "value": "(lowest)" } // Secondary line
          }
        }
      ]
    },
    // --- annotation that follows dropdown selection (single anxiety disorder chosen)
    {
      "transform": [
        { "filter": "disSelect!=='All'" }, // Only when a single category is chosen
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] }, // Sum across sex
        { "filter": "datum.group===disSelect" }, // Keep the selected
        { "calculate": "datum.group + ' (selected)'", "as": "note" } // Label
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#111", 
        "dy": -18 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" }, // Place above selected category
        "y": { "field": "total", "type": "quantitative" }, // At bar height
        "text": { "field": "note" } // Text content
      }
    }
  ],
  "config": { // Visual defaults for axes/legend/view
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};


// -------------------- ASSIGNMENT 2 AFFECTIVE CHART --------------------
const affectiveSpec = { // Horizontal bars for affective disorders by sex
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json", // Schema
  "width": 800, // Width
  "height": 360, // Height
  "padding": 20, // Padding
  "data": { "url": "combined_health.csv" }, // CSV
  "params": [ // Dropdown select for focus
    {
      "name": "affectiveSelect",
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Depressive Episode",
          "Dysthymia",
          "Bipolar Affective Disorder",
          "Any Affective disorder"
        ]
      }
    }
  ],
  "transform": [
    { "filter": "datum.dataset==='affective_by_sex'" }, // Keep affective subset
    { "calculate": "toNumber(datum.value)", "as": "value" }, // Numeric
    { "filter": "isValid(datum.value)" } // Clean
  ],
  "layer": [
    {
      "mark": { 
        "type": "bar", 
        "cornerRadius": 3, 
        "stroke": "#fff", 
        "strokeWidth": 1 
      },
      "params": [
        { "name": "affectiveSexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" } // Legend filter
      ],
      "encoding": {
        "x": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "group", 
          "type": "nominal", 
          "title": "Affective Disorder Type",
          "axis": {
            "labelFontSize": 12,
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": {
          "condition": [
            { "test": "affectiveSelect==='All' || datum.group===affectiveSelect", "value": 1 }, // Focus selection
            { "param": "affectiveSexSelect", "value": 0.8 } // Legend selection
          ],
          "value": 0.2
        },
        "tooltip": [
          { "field": "group", "title": "Affective Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [
        { "filter": "affectiveSelect==='All'" }, // Only when All
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] }, // Sum across sex
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] }, // Rank
        { "filter": "datum.rk===1" } // Keep highest
      ],
      "mark": { 
        "type": "text", 
        "align": "left", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dx": 10 
      },
      "encoding": {
        "x": { "field": "total", "type": "quantitative" }, // Position at value end
        "y": { "field": "group", "type": "nominal" }, // On that category
        "text": { "value": "← Highest" } // Label text
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};

// -------------------- ASSIGNMENT 2 SUBSTANCE CHART --------------------
const substanceSpec = { // Area chart for substance use by sex
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 850,
  "height": 360,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "transform": [
    { "filter": "datum.dataset==='substance_by_sex'" }, // Keep subset
    { "calculate": "toNumber(datum.value)", "as": "value" }, // Numeric
    { "filter": "isValid(datum.value)" } // Clean
  ],
  "layer": [
    {
      "mark": { 
        "type": "area", 
        "interpolate": "cardinal",
        "opacity": 0.7
      },
      "params": [
        { "name": "substanceSexSelect", "select": { "type": "point", "fields": ["sex"] }, "bind": "legend" } // Legend filter
      ],
      "encoding": {
        "x": { 
          "field": "group", 
          "type": "nominal", 
          "title": "Substance Use Disorder Type",
          "axis": {
            "labelAngle": -45,
            "labelFontSize": 11,
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "y": { 
          "field": "value", 
          "type": "quantitative", 
          "title": "Number of People",
          "axis": {
            "titleFontSize": 14,
            "titleColor": "#495057",
            "labelColor": "#6C757D"
          }
        },
        "color": { 
          "field": "sex", 
          "type": "nominal", 
          "title": "Gender",
          "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
        },
        "opacity": { "condition": { "param": "substanceSexSelect", "value": 0.7 }, "value": 0.25 }, // Dim deselected
        "tooltip": [
          { "field": "group", "title": "Substance Use Disorder" },
          { "field": "sex", "title": "Gender" },
          { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
        ]
      }
    },
    {
      "transform": [
        { "aggregate": [{ "op": "sum", "field": "value", "as": "total" }], "groupby": ["group"] }, // Sum across sex
        { "window": [{ "op": "rank", "as": "rk" }], "sort": [{ "field": "total", "order": "descending" }] }, // Rank
        { "filter": "datum.rk===1" } // Highest only
      ],
      "mark": { 
        "type": "text", 
        "align": "center", 
        "fontSize": 12, 
        "fontWeight": "bold", 
        "color": "#495057", 
        "dy": -10 
      },
      "encoding": {
        "x": { "field": "group", "type": "nominal" },
        "y": { "field": "total", "type": "quantitative" },
        "text": { "value": "↑ Highest" } // Label
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 14 },
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" },
    "view": {"stroke": "#E9ECEF", "strokeWidth": 1}
  }
};

// -------------------- ASSIGNMENT 2 LIFETIME CHART --------------------
const lifetimeSpec = { // Donut chart comparing lifetime status by sex
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 560,
  "height": 300,
  "padding": 20,
  "data": { "url": "combined_health.csv" },
  "params": [
    {
      "name": "lifetimeSelect", // Dropdown to focus a slice
      "value": "All",
      "bind": {
        "input": "select",
        "options": [
          "All",
          "Any lifetime mental disorder",
          "No lifetime mental disorder"
        ]
      }
    }
  ],
  "transform": [
    { "filter": "datum.dataset==='lifetime_by_sex'" }, // Keep lifetime subset
    { "calculate": "toNumber(datum.value)", "as": "value" }, // Numeric
    { "filter": "isValid(datum.value)" }, // Clean
    { "filter": "datum.group !== 'Total'" }, // Remove Total row
    { "filter": "lifetimeSelect==='All'|| datum.group===lifetimeSelect" } // Apply dropdown
  ],
  "mark": { 
    "type": "arc", 
    "innerRadius": 60, // Makes it a donut
    "stroke": "#fff",
    "strokeWidth": 2
  },
  "encoding": {
    "theta": { 
      "field": "value", 
      "type": "quantitative" 
    },
    "color": { 
      "field": "sex", 
      "type": "nominal", 
      "title": "Gender",
      "scale": {"domain":["Female","Male"],"range":["#2563eb","#f59e0b"]}
    },
    "tooltip": [
      { "field": "group", "title": "Mental Health Status" },
      { "field": "sex", "title": "Gender" },
      { "field": "value", "type": "quantitative", "title": "Number of People", "format": ",.0f" }
    ]
  },
  "config": {
    "legend": { "titleFontSize": 12, "labelFontSize": 12, "titleColor": "#495057", "labelColor": "#6C757D" }
  }
};

// -------------------- EMBED ALL CHARTS --------------------
vegaEmbed("#map", mapSpec, {actions:false}); // Render the choropleth map
vegaEmbed("#bars", barsSpec, {actions:false}); // Render the grouped bars
vegaEmbed("#affective", affectiveSpec, {actions:false}); // Render affective bars
vegaEmbed("#substance", substanceSpec, {actions:false}); // Render substance area
vegaEmbed("#lifetime", lifetimeSpec, {actions:false}); // Render lifetime donut
</script> <!-- End JavaScript -->
</body> <!-- End body -->
</html> <!-- End document -->
